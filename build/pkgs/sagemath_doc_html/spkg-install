#!/usr/bin/env bash
# From sage-spkg.
# For type=script packages, the build rule in build/make/Makefile sources
# sage-env but not sage-dist-helpers.
lib="$SAGE_ROOT/build/bin/sage-dist-helpers"
source "$lib"
if [ $? -ne 0 ]; then
    echo >&2 "Error: failed to source $lib"
    echo >&2 "Is $SAGE_ROOT the correct SAGE_ROOT?"
    exit 1
fi
cd src
# Needed because of trees.txt directs us to $SAGE_LOCAL/...
export PIP_FIND_LINKS=$SAGE_VENV/var/lib/sage/wheels
python3 -m pip install --verbose --no-index --no-build-isolation --config-settings=editable-verbose=true --config-settings=compile-args="-j12" --config-settings=compile-args="--verbose" --editable . || sdh_die "Error installing $PKG_NAME"
